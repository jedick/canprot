---
title: "canprot: Chemical metrics of proteins"
output:
  html_vignette:
    mathjax: null
vignette: >
  %\VignetteIndexEntry{canprot: Chemical metrics of proteins}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: canprot.bib
csl: elementa.csl
---

```{r setup, include=FALSE}
library(canprot)
library(CHNOSZ)
oldopt <- options(width = 72)
```

```{r HTML, include=FALSE}
ZC <- "<i>Z</i><sub>C</sub>"
nC <- "<i>n</i><sub>C</sub>"
nH2O <- "<i>n</i><sub>H<sub>2</sub>O</sub>"
H2O <- "H<sub>2</sub>O"
O2 <- "O<sub>2</sub>"
```

The **canprot** package has functions to calculate chemical metrics of proteins from their amino acid composition.
This vignette was compiled on `r Sys.Date()` with **canprot** version `r packageDescription("canprot")$Version`.

## Calculating chemical metrics

Specify the amino acid composition of a protein in a data frame or matrix with column names corresponding to the 3-letter abbreviations of the amino acids.
This can be done as follows for the dipeptide alanylglycine:
```{r AG}
AG <- data.frame(Ala = 1, Gly = 1)
```

Use the functions `Zc` and `nH2O` to calculate the carbon oxidation state (`r ZC`) and stoichiometric hydration state (`r nH2O`) of the molecules.
The value of `r nH2O` is normalized by protein length (i.e. it is divided by the number of amino acid residues), but carbon oxidation state is a per-carbon value, and it is not divided by the number of residues.
```{r AG_metrics}
Zc(AG)
nH2O(AG)
```

With default settings, `r nH2O` is calculated from a theoretical overall reaction to form the protein from the basis species glutamine, glutamic acid, cysteine, `r H2O`, and `r O2`, abbreviated as **QEC** (the setting can be viewed with `getOption("basis")`).
To see how this works, consider the formation reaction of alanylglycine, which can be written using functions in the **CHNOSZ** package:
```{r AG_reaction, message = FALSE}
CHNOSZ::basis("QEC")
CHNOSZ::subcrt("alanylglycine", 1)$reaction
```

Alanylglycine has the same formula as glutamine, so there is no water in the reaction, and `r nH2O` is zero.

### Protein Data 1: CHNOSZ package

For a more practical example, let's try an actual protein, chicken egg-white lysozome, which has the name LYSC\_CHICK in UniProt with accession number [P00698](https://www.uniprot.org/uniprot/P00698).
The amino acid compositions of this and selected other proteins are available in the **CHNOSZ** package.
Here we get the amino acid composition and also print the protein length:
```{r LYSC_CHICK}
AA <- CHNOSZ::pinfo(CHNOSZ::pinfo("LYSC_CHICK"))
CHNOSZ::protein.length(AA)
AA
```

This data frame has some other identifying information (protein and organism names, reference, accession number in the `abbrv` column) as well as `chains` to indicate the number of polypeptide chains.
However, the important thing here are the 20 columns with amino acid frequencies; this means we can use the data frame with the functions in **canprot** to calculate chemical metrics:
```{r LYSC_metrics}
Zc(AA)
nH2O(AA)
```

Now we can look at the formation reaction of LYSC\_CHICK from the **QEC** basis species to see where the value of `r nH2O` comes from.
```{r LYSC_reaction, message = FALSE}
CHNOSZ::subcrt("LYSC_CHICK", 1)$reaction
```

This shows that `r with(CHNOSZ::subcrt("LYSC_CHICK", 1)$reaction, coeff[name == "water"])` water molecules are released in the reaction.
`r nH2O` is the opposite of this value (because we are counting how many `r H2O` units go **into** forming the protein), divided by the length of the protein (`r CHNOSZ::protein.length(AA)`), which gives us the value of `r nH2O`: `r nH2O(AA)`.

`nH2O` works not by writing the formation reaction for each protein but rather by using precomputed values of `r nH2O` for each amino acid.
The two methods give equivalent results, as described in @DYT20.

Similarly, `Zc` uses precomputed values of `r ZC` and `r nC` (number of carbon atoms) for each amino acid.
**NOTE**: Calculating `r ZC` of proteins from amino acid frequencies (i.e. abundances or counts in a protein sequence) requires weighting the amino-acid `r ZC` by the number of carbon atoms in each amino acid, in addition to weighting by amino acid frequency.
Using the unweighted mean of `r ZC` of amino acids is a common mistake that leads to artificially higher values for proteins.

### Protein Data 2: canprot package

**canprot** has a database of amino acid compositions of human proteins assembled from UniProt.
If you have a UniProt ID for a human protein, such as `P24298`, use `protcomp` to get the amino acid composition:
```{r protcomp}
(pc <- protcomp("P24298"))
Zc(pc$aa)
```

You can also provide a file with amino acid compositions for non-human proteins.
This file lists proteins identified in a study of the response of an archaeal organism to salt and temperature stress [@JSP+19].
Note that high `r ZC` is a characteristic of many proteins in halophiles [@DYT20].
```{r protcomp_archaea}
aa_file <- system.file("extdata/aa/archaea/JSP+19_aa.csv.xz", package = "canprot")
pc <- protcomp("D4GP79", aa_file = aa_file)
Zc(pc$aa)
```

### Other chemical metrics

There are also functions for calculating the grand average of hydropathicity (GRAVY, which is higher for proteins with more hydrophobic amino acids) and isoelectric point (pI) of proteins.
There are some limitations of this implementation (see @DYT20 for details), but values for representative proteins are equal to those computed with the ProtParam tool [@GHG+05] in UniProt (see `?pI` for numerical tests).
```{r GRAVY_pI}
proteins <- c("LYSC_CHICK", "RNAS1_BOVIN", "AMYA_PYRFU")
AA <- CHNOSZ::pinfo(CHNOSZ::pinfo(proteins))
pI(AA)
GRAVY(AA)
```

```{r reset, include=FALSE}
options(oldopt)
```

## References
